\begin{tikzpicture}[
        scale=0.9,
        every node/.style={circle, draw, minimum size=0.7cm, font=\small},
        arrow/.style={->, >=stealth, thick},
        cycle/.style={fill=yellow!30},
        supervertex/.style={fill=red!30, minimum size=1cm},
        external/.style={fill=blue!10}
    ]

    % LADO ESQUERDO: Grafo original D com ciclo C
    \begin{scope}[local bounding box=left]
        % Vértices externos
        \node[external] (r) at (0, 3) {$r$};
        \node[external] (v1) at (0, 0) {$v_1$};
        \node[external] (v5) at (6, 1.5) {$v_5$};

        % Vértices do ciclo C (destacados em amarelo)
        \node[cycle] (v2) at (2, 3) {$v_2$};
        \node[cycle] (v3) at (4, 3.5) {$v_3$};
        \node[cycle] (v4) at (4, 1) {$v_4$};

        % Arestas do ciclo C
        \draw[arrow, red, thick] (v2) -- node[midway, above, fill=white, inner sep=1pt, font=\tiny] {3} (v3);
        \draw[arrow, red, thick] (v3) -- node[midway, right, fill=white, inner sep=1pt, font=\tiny] {2} (v4);
        \draw[arrow, red, thick] (v4) -- node[midway, below left, fill=white, inner sep=1pt, font=\tiny] {4} (v2);

        % Arestas de entrada no ciclo (de vértices externos)
        \draw[arrow, blue] (r) -- node[midway, above, fill=white, inner sep=1pt, font=\tiny] {2} (v2);
        \draw[arrow, blue] (r) to[bend right=15] node[midway, below, fill=white, inner sep=1pt, font=\tiny] {5} (v4);
        \draw[arrow] (v1) -- node[midway, left, fill=white, inner sep=1pt, font=\tiny] {3} (v2);

        % Arestas de saída do ciclo (para vértices externos)
        \draw[arrow, green!60!black] (v4) -- node[midway, above, fill=white, inner sep=1pt, font=\tiny] {1} (v5);

        % Outras arestas
        \draw[arrow] (r) -- node[midway, left, fill=white, inner sep=1pt, font=\tiny] {6} (v1);

        % Caixa destacando o ciclo
        \draw[dashed, red, thick, rounded corners] (1.5, 0.5) rectangle (4.5, 4);
        \node[above, red, font=\small\bfseries] at (3, 4) {Ciclo $C$};

        % Título
        \node[above, font=\small\bfseries] at (3, 4.8) {Grafo original $D$};
    \end{scope}

    % SETA DE TRANSFORMAÇÃO
    \node[font=\Large, right=2.5cm of left] (arrow) {$\Rightarrow$};
    \node[below=0.2cm of arrow, font=\scriptsize, text width=2cm, align=center] {\texttt{contract\_cycle(D, C, "x\_C")}};

    % LADO DIREITO: Grafo contraído D' com supervértice x_C
    \begin{scope}[local bounding box=right, xshift=11cm]
        % Vértices externos (mesmas posições relativas)
        \node[external] (r2) at (0, 3) {$r$};
        \node[external] (v1_2) at (0, 0) {$v_1$};
        \node[external] (v5_2) at (6, 1.5) {$v_5$};

        % Supervértice x_C (no centro onde estava o ciclo)
        \node[supervertex] (xc) at (3, 2.25) {$x_C$};

        % Aresta de entrada no supervértice (menor peso: r -> v2 com peso 2)
        \draw[arrow, blue, thick] (r2) -- node[midway, above left, fill=white, inner sep=1pt, font=\tiny] {2} (xc);
        \draw[arrow] (v1_2) -- node[midway, below left, fill=white, inner sep=1pt, font=\tiny] {3} (xc);

        % Aresta de saída do supervértice
        \draw[arrow, green!60!black, thick] (xc) -- node[midway, above, fill=white, inner sep=1pt, font=\tiny] {1} (v5_2);

        % Outras arestas
        \draw[arrow] (r2) -- node[midway, left, fill=white, inner sep=1pt, font=\tiny] {6} (v1_2);

        % Título
        \node[above, font=\small\bfseries] at (3, 4.8) {Grafo contraído $D'$};

        % Anotações dos dicionários
        \node[below, font=\tiny, text width=5cm, align=left] at (3, -0.8) {
            \texttt{in\_to\_cycle} $= \{r: (v_2, 2), v_1: (v_2, 3)\}$ \\
            \texttt{out\_from\_cycle} $= \{v_5: (v_4, 1)\}$
        };
    \end{scope}

\end{tikzpicture}
